# effective-mobile-test-task
 
Тестовое задание в Infotecs на позицию Go-разработчик

## Запуск

### Докер
```
> docker-compose build
> docker-compose up
```

### Локально

Зависимости
```
> go mod download
> go run 
```
Миграция
```
> go run cmd/migrations/postgres/main.go top
```
Запуск
```
> go run cmd/api/main.go
```

## Миграции

`cmd/migrations/main.go` принимает аргумент трёх видов:
- `n` - число, отвечающее за количество миграций (`n` > 0 - вверх, `n` < 0 - вниз, `n` = 0 - ошибка)
- `top` - к самой последней версии
- `drop` - сбросить все миграции

## Конфигурирование

### Для докера

файл `.env` в корневом каталоге

### Для локального запуска

файл `config/local.env`

## Ручки

### Create `POST`

`api/v1/wallet` - создание нового кошелька

#### Запрос:
Запрос пустой

#### Типы ответов:
- `CreateWalletResponse`
```
{
    "id": string,
    "balance": float32
}
```

#### Ответы:
| код   | тело                       | пояснение                                                   |
|-------|----------------------------|-------------------------------------------------------------|
| `201` | ```CreateWalletResponse``` | кошелёк **создан**                                          |
| `400` | -                          | кошелёк **не создан**; неверный запрос                      |
| `507` | -                          | кошелёк **не создан**; не удалось создать запись о кошельке |


### Send `POST`

`api/v1/wallet/{walletId}/send` - трансфер средств с одного кошелька на другой

#### Запрос:

Query:

| имя        | тип      | значение                | обязателен |
|------------|----------|-------------------------|------------|
| `walletId` | `string` | id кошелька отправителя | да         |


#### Ответы:
| код   | тело | пояснение                                                        |
|-------|------|------------------------------------------------------------------|
| `200` | -    | деньги **переведены**                                            |
| `400` | -    | деньги **не переведены**; неверный запрос                        |
| `404` | -    | деньги **не переведены**; не найдён кошелёк отправителя          |
| `507` | -    | деньги **не переведены**; не удалось создать запись о транзакции |

### Get Wallet `GET`

`api/v1/wallet/{walletId}` - получение информации о кошельке

#### Запрос:

Query:

| имя        | тип      | значение    | обязателен |
|------------|----------|-------------|------------|
| `walletId` | `string` | id кошелька | да         |

#### Типы ответов:
- `GetWalletResponse`
```
{
    "id": string,
    "balance": float32
}
```

#### Ответы:

| код   | тело                | пояснение                                         |
|-------|---------------------|---------------------------------------------------|
| `200` | `GetWalletResponse` | данные **получены**                               |
| `400` | -                   | данные **не получены**; неверный запрос           |
| `404` | -                   | данные **не получены**; кошелёк не найден         |
| `500` | -                   | данные **не получены**; ошибка на стороне сервера |

### Get `GET`

`api/v1/wallet/{walletId}/history` - получение информации о переводах

#### Запрос:

Query:

| имя        | тип      | значение    | обязателен |
|------------|----------|-------------|------------|
| `walletId` | `string` | id кошелька | да         |

#### Типы ответов:
- `TransactionsHistoryResponse`
```
[
    {
        "time": string,
        "from": string,
        "to": string,
        "amount": float32,
    },
    ...
]
```

#### Ответы:

| код   | тело                          | пояснение                                                                         |
|-------|-------------------------------|-----------------------------------------------------------------------------------|
| `200` | `TransactionsHistoryResponse` | история **найдена**; сам список может быть пустым, если транзакций не проводилось |
| `400` | -                             | история **не найдена**; неверный запрос                                           |
| `404` | -                             | история **не найдена**; не найден указанный кошелёк                               |
| `500` | -                             | история **не найдена**; проблема на стороне сервера                               |

## Swagger

По адресу `swagger/index.html` представлен GUI со всеми выше описанными ручками
